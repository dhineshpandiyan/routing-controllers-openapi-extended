# routing-controllers-openapi-extended

[![Build Status](https://travis-ci.com/dhineshpandiyan/routing-controllers-openapi-extended.svg?branch=master)](https://travis-ci.org/dhineshpandiyan/routing-controllers-openapi-extended)

Swagger v2 and OpenAPI v3 schema generation using beautiful typescript decorators.

## Table of Contents

- [About](#about)
- [Installation](#installation)
- [Usage](#usage)
- [Available API's](#available-apis)
  - [.generateSwagger(storage, options, validationMetadata, additional)](#generateswaggerstorage-options-validationmetadata-additional)
  - [.generateOpenAPI(storage, options, validationMetadata, additional)](#generateOpenAPIstorage-options-validationmetadata-additional)
- [Available Decorators](#available-decorators)
  - [@OperationInfo(options)](#operationinfooptions)
    - [@Available Options](#available-options)
    - [@Example](#example)
  - [@CustomEntry(options)](#customentryoptions)
    - [@Available Options](#available-options)
    - [@Example](#example)
  - [@CodeSnippets(options)](#codesnippetsoptions)
    - [@Available Options](#available-options)
    - [@Example](#example)
- [Next goals](#next-goals)
- [References](#references)


## About

This node module will extract much information about operations, parameters, responses from `routing-controller` decorator methods. Additinally it provides some more typescript decorators which will be useful to add user defined custom properties to the generated swagger specification. This library uses `class-validator` decorator to generate schema definitions currently. 

## Installation

`npm i routing-controllers-openapi-extended`

## Usage

```typescript
import { IsOptional, IsString, MaxLength } from 'class-validator'
import { Body, Get, JsonController, Param, Post, Put } from 'routing-controllers'
import { OperationInfo } from 'routing-controllers-openapi-extended';

class CreateUserBody {
  @IsString()
  name: string

  @IsOptional()
  @MaxLength(20, { each: true })
  hobbies: string[]

}

@JsonController('/users')
export class UsersController {

  @Get('/:id')
  @OperationInfo({ summary: 'Get user by Id', description: 'Get user by Id' })
  getOne(@Param('id') id: number) {
    return { name: 'User #' + id }
  }

  @Post('/')
  createUser(@Body({ validate: true }) body: CreateUserBody) {
    return { ...body, id: 3 }
  }

}


// Generate a schema:

import 'reflect-metadata'
import { getFromContainer, MetadataStorage } from 'class-validator'
import { getMetadataArgsStorage } from 'routing-controllers'
import { generateSwagger } from 'routing-controllers-openapi-extended'

import { UsersController } from './UsersController'

const routingControllersOptions = {
  controllers: [UsersController],
  routePrefix: '/api'
}
const metadatas = (getFromContainer(MetadataStorage) as any).validationMetadatas
const storage = getMetadataArgsStorage()
const spec = generateSwagger(storage, routingControllersOptions, metadatas, {
  info: {
    description: 'Generated by script',
    title: 'A sample API',
    version: '1.0.0'
  }
});

console.log(JSON.stringify(spec, undefined, 2));

```

This will generate below swagger v2 specification:

```json
{
  "swagger": "2.0",
  "paths": {
    "/api/users/{id}": {
      "get": {
        "operationId": "UsersController.getOne",
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "number"
            }
          }
        ],
        "responses": {
          "200": {
            "content": {
              "application/json": {}
            },
            "description": "Successful response"
          }
        },
        "summary": "Get user by Id",
        "tags": [
          "Users"
        ],
        "description": "Get user by Id"
      }
    },
    "/api/users/": {
      "post": {
        "operationId": "UsersController.createUser",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/definitions/CreateUserBody"
              }
            }
          },
          "description": "CreateUserBody",
          "required": false
        },
        "responses": {
          "200": {
            "content": {
              "application/json": {}
            },
            "description": "Successful response"
          }
        },
        "summary": "Create user",
        "tags": [
          "Users"
        ]
      }
    }
  },
  "definitions": {
    "CreateUserBody": {
      "properties": {
        "name": {
          "type": "string"
        },
        "hobbies": {
          "items": {
            "maxLength": 20,
            "type": "string"
          },
          "type": "array"
        }
      },
      "type": "object",
      "required": [
        "name"
      ]
    }
  },
  "info": {
    "description": "Generated by script",
    "title": "A sample API",
    "version": "1.0.0"
  }
}
```

Check [`/sample`](/sample) for a complete sample application.


## Available API's

### .generateSwagger(storage, options, validationMetadata, additional)

This API will be used to generate swagger 2.0 specifications.

### .generateOpenAPI(storage, options, validationMetadata, additional)

This API will be used to generate Open API 3.0 configurations.

## Available Decorators

### @OperationInfo(options)
This is used to specify most of the basic information about each operations. 

#### Available Options 
- `summary` [`String`] - used to specify summary information about operation
- `description` [`String`] - used to specify description information about operation
- `operationId` [`String`] - used to specify / override operation id about operation
- `consumes` [`Array<string>`] - used to specify consumer list
- `produces` [`Array<string>`] - used to specify produces list
- `security` [`any`] - allow user to define their own security specification

#### Example
```typescript
@OperationInfo({ summary: '', description: '', operationId: '' })
```

### @CustomEntry(options)
This is used to add all custom properties which may/ may not be specified in swagger sepcification.

#### Available Options 
- `<any key name>` [`any`] - entire object will be attached to the specific operation

#### Example
```typescript
@CustomEntry({ customField: '' })
```

### @CodeSnippets(options)
This is another kind of custom entry which can be attached to operation sepcification. 

#### Available Options 
- `lang` [`String`] - used to specify language
- `snippet` [`String`] - used to specify sample code


#### Example
```typescript
@CodeSnippets([{ lang: '', snippet: '' }])
```

## Next goals

- Decorators to customize paramters
- Support to specify schema models via API
- Support to customize schema definitions generated from Models.
- Implement logging to troubleshot generaiton operation

## References
- [routing-controllers](https://github.com/typestack/routing-controllers)
- [class-validator](https://github.com/typestack/class-validator)
